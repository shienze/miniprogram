<!-- pages/user/post-detail.wxml -->
<view class="container">
  <!-- 调试信息 -->
  <view wx:if="{{false}}" style="background: #f0f0f0; padding: 10rpx; margin: 20rpx; border-radius: 10rpx;">
    <text>调试信息: post={{post ? '有数据' : '无数据'}}, loading={{loading}}</text>
  </view>

  <view class="post-content" wx:if="{{!loading && post}}">
    <view class="post-header">
      <image class="author-avatar" src="{{post.authorAvatar}}" mode="aspectFill" />
      <view class="author-info">
        <text class="author-name">{{post.author}}</text>
        <text class="post-time">{{post.time}}</text>
      </view>
    </view>
    
    <text class="post-title">{{post.title}}</text>
    
    <!-- 处理内容显示 -->
    <view class="post-body">
      <rich-text wx:if="{{post.content}}" nodes="{{post.content}}" />
      <text wx:else class="empty-content">暂无内容</text>
    </view>
    
    <view class="post-tags" wx:if="{{post.tags && post.tags.length > 0}}">
      <text class="tag" wx:for="{{post.tags}}" wx:key="index">#{{item}}</text>
    </view>
    
    <view class="post-actions">
      <button class="action-btn" bindtap="toggleLike">
        {{ liked ? '已点赞' : '点赞' }} ({{post.likes}})
      </button>
      <text class="action">评论 ({{post.comments}})</text>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <text>加载中...</text>
  </view>

  <!-- 空状态 -->
  <view wx:if="{{!loading && !post}}" class="empty-container">
    <text>帖子不存在或已删除</text>
  </view>
  
  <view class="comment-section" wx:if="{{!loading && post}}">
    <text class="section-title">评论区 ({{comments.length}})</text>
    <view class="comment-list">
      <view class="comment-item" wx:for="{{comments}}" wx:key="id">
        <image class="comment-avatar" src="{{item.avatar || '/images/default-avatar.png'}}" />
        <view class="comment-info">
          <text class="comment-author">{{item.author}}</text>
          <text class="comment-text">{{item.text}}</text>
          <text class="comment-time">{{item.time}}</text>
        </view>
      </view>
      <view wx:if="{{comments.length === 0}}" class="empty">
        <text>暂无评论，快来发表第一条评论吧~</text>
      </view>
    </view>
    
    <view class="comment-input">
      <input class="input" placeholder="输入评论..." bindinput="inputComment" value="{{newComment}}" />
      <button class="submit-btn" bindtap="submitComment" disabled="{{submitting}}">
        {{submitting ? '发送中...' : '发送'}}
      </button>
    </view>
  </view>
</view>